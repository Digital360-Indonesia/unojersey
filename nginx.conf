#=========================================================================#
# Static Site Configuration for UnoJersey.com                             #
#=========================================================================#

server {
    listen      72.61.214.241:80;
    server_name unojersey.com www.unojersey.com;

    # Redirect HTTP to HTTPS
    return 301 https://$server_name$request_uri;
}

#=========================================================================#
# HTTPS Configuration - Static Site                                      #
#=========================================================================#

server {
    listen      72.61.214.241:443 ssl;
    server_name unojersey.com www.unojersey.com;

    root        /home/fabrikgroup/web/unojersey.com/public_html/dist;
    index       index.html;

    # SSL Configuration
    ssl_certificate     /home/fabrikgroup/conf/web/unojersey.com/ssl/unojersey.com.pem;
    ssl_certificate_key /home/fabrikgroup/conf/web/unojersey.com/ssl/unojersey.com.key;
    ssl_stapling        on;
    ssl_stapling_verify on;

    # TLS 1.3 0-RTT anti-replay
    if ($anti_replay = 307) { return 307 https://$host$request_uri; }
    if ($anti_replay = 425) { return 425; }

    # Include HSTS configuration
    include /home/fabrikgroup/conf/web/unojersey.com/nginx.hsts.conf*;

    # Protect hidden files
    location ~ /\.(?!well-known\/|file) {
        deny all;
        return 404;
    }

    # ============================
    # MAIN LOCATION - Static Files
    # ============================
    location / {
        # Try to serve file directly, fallback to directory with index.html
        try_files $uri $uri/ $uri/index.html =404;
    }

    # Cache static assets for better performance
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|webp|mp4|webm)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
        try_files $uri =404;
    }

    # Security headers
    add_header X-Frame-Options "SAMEORIGIN" always;
    add_header X-Content-Type-Options "nosniff" always;
    add_header X-XSS-Protection "1; mode=block" always;

    # Error pages
    error_page 404 /404.html;
    error_page 500 502 503 504 /50x.html;

    location = /50x.html {
        root /usr/share/nginx/html;
    }

    # Log files
    access_log  /var/log/apache2/domains/unojersey.com.access.log;
    error_log   /var/log/apache2/domains/unojersey.com.error.log error;
}
